<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TraderMr.KP | Tradefinder Pro</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { background-color: #0d1117; color: #c9d1d9; font-family: sans-serif; }
        .card { background: #161b22; border: 1px solid #30363d; border-radius: 12px; padding: 20px; box-shadow: 0 4px 10px rgba(0,0,0,0.5); }
        .input-field { background: #0d1117; border: 1px solid #30363d; color: white; padding: 12px; border-radius: 8px; width: 100%; margin-top: 5px; outline: none; }
        .input-field:focus { border-color: #1f6feb; }
        .btn-action { transition: all 0.3s ease; font-weight: bold; cursor: pointer; }
        .btn-action:hover { opacity: 0.8; transform: translateY(-1px); }
    </style>
</head>
<body class="p-4 md:p-8">

    <div class="max-w-5xl mx-auto">
        <div class="text-center mb-10">
            <h1 class="text-4xl font-extrabold text-blue-500 mb-2">TraderMr.KP Tradefinder</h1>
            <p class="text-gray-400">100-Trade Challenge Tracker & Analysis Tool</p>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-10">
            
            <div class="card border-t-4 border-blue-600">
                <h3 class="text-blue-400 font-bold mb-4 flex items-center">üìä PCR Calculator</h3>
                <input type="number" id="pOI" placeholder="Total Put OI" class="input-field mb-3">
                <input type="number" id="cOI" placeholder="Total Call OI" class="input-field mb-3">
                <button onclick="calcPCR()" class="w-full bg-blue-600 p-3 rounded-lg btn-action text-white">Calculate Trend</button>
                <div id="pRes" class="mt-4 p-3 rounded text-center hidden font-bold"></div>
            </div>

            <div class="card border-t-4 border-yellow-500">
                <h3 class="text-yellow-500 font-bold mb-4 flex items-center">üìà EMA 9/21 Analyzer</h3>
                <input type="number" id="e9" placeholder="9 EMA Value" class="input-field mb-3">
                <input type="number" id="e21" placeholder="21 EMA Value" class="input-field mb-3">
                <button onclick="calcEMA()" class="w-full bg-yellow-600 p-3 rounded-lg btn-action text-black">Check Crossover</button>
                <div id="eRes" class="mt-4 p-3 rounded text-center hidden font-bold text-black"></div>
            </div>

            <div class="card border-t-4 border-green-500">
                <h3 class="text-green-500 font-bold mb-4 flex items-center">üõ°Ô∏è Position Sizer</h3>
                <input type="number" id="risk" placeholder="Risk Amount (‚Çπ)" class="input-field mb-3">
                <input type="number" id="slPts" placeholder="SL Points" class="input-field mb-3">
                <button onclick="calcPos()" class="w-full bg-green-600 p-3 rounded-lg btn-action text-white">Calculate Quantity</button>
                <div id="posRes" class="mt-4 text-center text-green-400 font-bold text-lg"></div>
            </div>

        </div>

        <div class="card mb-10 border-l-4 border-purple-500">
            <h3 class="text-xl font-bold mb-5 text-purple-400">üìù Log New Trade</h3>
            <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                <div>
                    <label class="text-xs text-gray-500">Instrument</label>
                    <input type="text" id="tName" placeholder="e.g. NIFTY 25600 CE" class="input-field">
                </div>
                <div>
                    <label class="text-xs text-gray-500">Setup Used</label>
                    <select id="tSetup" class="input-field text-gray-400">
                        <option value="EMA 9/21">EMA 9/21 Crossover</option>
                        <option value="Breakout">Range Breakout</option>
                        <option value="Scalp">Quick Scalp</option>
                    </select>
                </div>
                <div>
                    <label class="text-xs text-gray-500">Points P/L</label>
                    <input type="number" id="tPts" placeholder="e.g. 20 or -15" class="input-field">
                </div>
                <div class="flex items-end">
                    <button onclick="saveTrade()" class="w-full bg-purple-600 p-3 rounded-lg btn-action text-white mb-[2px]">Add to Journal</button>
                </div>
            </div>
        </div>

        <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-8">
            <div class="card text-center p-4">
                <p class="text-gray-400 text-xs">Total Trades</p>
                <p id="count" class="text-2xl font-bold">0</p>
            </div>
            <div class="card text-center p-4">
                <p class="text-gray-400 text-xs">Net Points</p>
                <p id="plSum" class="text-2xl font-bold text-green-500">0</p>
            </div>
            <div class="card text-center p-4">
                <p class="text-gray-400 text-xs text-blue-400">Win Rate</p>
                <p id="winRate" class="text-2xl font-bold">0%</p>
            </div>
            <div class="card text-center p-4">
                <p class="text-gray-400 text-xs">100 Trade Goal</p>
                <p id="progress" class="text-2xl font-bold text-yellow-500">0/100</p>
            </div>
        </div>

        <div class="card overflow-hidden p-0">
            <div class="p-5 border-b border-gray-800 flex justify-between items-center">
                <h3 class="font-bold">Trade History</h3>
                <button onclick="clearData()" class="text-xs text-red-500 hover:underline">Clear All Data</button>
            </div>
            <div class="overflow-x-auto">
                <table class="w-full text-left">
                    <thead class="bg-gray-800 text-gray-400 text-xs uppercase">
                        <tr>
                            <th class="p-4">Date</th>
                            <th class="p-4">Instrument</th>
                            <th class="p-4">Setup</th>
                            <th class="p-4">Points</th>
                            <th class="p-4">Action</th>
                        </tr>
                    </thead>
                    <tbody id="logBody" class="divide-y divide-gray-800">
                        </tbody>
                </table>
            </div>
        </div>
    </div>

    <script>
        // --- TOOLS LOGIC ---
        function calcPCR() {
            const p = parseFloat(document.getElementById('pOI').value);
            const c = parseFloat(document.getElementById('cOI').value);
            const r = document.getElementById('pRes');
            if(isNaN(p) || isNaN(c)) return;
            const v = (p/c).toFixed(2);
            r.className = `mt-4 p-3 rounded text-center block font-bold ${v < 0.7 ? 'bg-green-900 text-green-300' : (v > 1.3 ? 'bg-red-900 text-red-300' : 'bg-gray-700 text-white')}`;
            r.innerText = `PCR: ${v} - ${v < 0.7 ? 'Oversold (Bullish?)' : (v > 1.3 ? 'Overbought (Bearish?)' : 'Neutral Market')}`;
        }

        function calcEMA() {
            const e9 = parseFloat(document.getElementById('e9').value);
            const e21 = parseFloat(document.getElementById('e21').value);
            const r = document.getElementById('eRes');
            if(isNaN(e9) || isNaN(e21)) return;
            const isBullish = e9 > e21;
            r.className = `mt-4 p-3 rounded text-center block font-bold ${isBullish ? 'bg-green-500' : 'bg-red-500'}`;
            r.innerText = isBullish ? "BULLISH CROSSOVER" : "BEARISH CROSSOVER";
        }

        function calcPos() {
            const rk = parseFloat(document.getElementById('risk').value);
            const sl = parseFloat(document.getElementById('slPts').value);
            if(isNaN(rk) || isNaN(sl) || sl === 0) return;
            document.getElementById('posRes').innerText = `Recommended Qty: ${Math.floor(rk/sl)} Units`;
        }

        // --- JOURNAL LOGIC ---
        function saveTrade() {
            const n = document.getElementById('tName').value;
            const s = document.getElementById('tSetup').value;
            const p = parseFloat(document.getElementById('tPts').value);
            if(!n || isNaN(p)) return alert("Please fill all trade details!");
            
            const tr = { d: new Date().toLocaleDateString('en-IN'), n, s, p };
            let arr = JSON.parse(localStorage.getItem('traderKP_Final')) || [];
            arr.unshift(tr); // Newest trade on top
            localStorage.setItem('traderKP_Final', JSON.stringify(arr));
            
            // Clear inputs
            document.getElementById('tName').value = '';
            document.getElementById('tPts').value = '';
            showTrades();
        }

        function showTrades() {
            const arr = JSON.parse(localStorage.getItem('traderKP_Final')) || [];
            const body = document.getElementById('logBody');
            body.innerHTML = '';
            let sum = 0, wins = 0;

            arr.forEach((t, i) => {
                sum += t.p; 
                if(t.p > 0) wins++;
                body.innerHTML += `
                    <tr class="hover:bg-gray-800/50 transition">
                        <td class="p-4 text-sm text-gray-400">${t.d}</td>
                        <td class="p-4 font-bold text-white">${t.n}</td>
                        <td class="p-4 text-sm text-purple-400">${t.s}</td>
                        <td class="p-4 font-bold ${t.p >= 0 ? 'text-green-500' : 'text-red-500'}">${t.p > 0 ? '+' + t.p : t.p}</td>
                        <td class="p-4"><button onclick="del(${i})" class="text-red-500 hover:text-red-400 font-bold">√ó</button></td>
                    </tr>`;
            });

            // Update Stats
            document.getElementById('count').innerText = arr.length;
            document.getElementById('plSum').innerText = sum;
            document.getElementById('plSum').className = `text-2xl font-bold ${sum >= 0 ? 'text-green-500' : 'text-red-500'}`;
            document.getElementById('winRate').innerText = arr.length ? Math.round((wins/arr.length)*100) + '%' : '0%';
            document.getElementById('progress').innerText = `${arr.length}/100`;
        }

        function del(i) {
            let arr = JSON.parse(localStorage.getItem('traderKP_Final'));
            arr.splice(i, 1);
            localStorage.setItem('traderKP_Final', JSON.stringify(arr));
            showTrades();
        }

        function clearData() {
            if(confirm("Are you sure you want to delete all trade history?")) {
                localStorage.removeItem('traderKP_Final');
                showTrades();
            }
        }

        window.onload = showTrades;
    </script>
</body>
</html>
